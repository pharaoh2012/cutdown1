<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QR Code with Watermark</title>
</head>
<body>

<canvas id="qrCanvas" width="200" height="200"></canvas>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
  const canvas = document.getElementById('qrCanvas');
  const ctx = canvas.getContext('2d');

  const qrData = "https://example.com"; // 你要编码的内容
  const watermarkText = "水印文字";

  // Step 1: 生成二维码并绘制到 canvas 上
  QRCode.toDataURL(qrData, { errorCorrectionLevel: 'H' }, (err, url) => {
    if (err) throw err;

    const img = new Image();
    img.onload = () => {
      // 绘制二维码图片
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

      // 设置水印样式
      ctx.font = "40px Arial";
      ctx.fillStyle = "rgba(255, 0, 0, 0.5)"; // 半透明红色字体
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";

      // 在中间添加水印文字
      ctx.fillText(watermarkText, canvas.width / 2, canvas.height / 2);

      // 如果需要下载或上传，可使用下面的方法获取 base64 数据
      // const finalDataURL = canvas.toDataURL("image/png");
    };
    img.src = url;
  });
</script>

</body>
</html>